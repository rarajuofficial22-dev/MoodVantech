<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoodVantech</title>
    
    <style>
        :root {
            --background-color: #121212;
            --surface-color: #1e1e1e;
            --surface-light: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --accent-color: #1DB954;
            --border-color: #333;
        }
        *, *::before, *::after { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: var(--background-color);
            color: var(--text-primary);
            padding-bottom: 80px;
        }
        main { padding: 0 1.5rem 1.5rem 1.5rem; max-width: 1200px; margin: auto; display: none; }
        .page-content { display: none; animation: fadeIn 0.3s ease-in-out; }
        .page-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Loading Spinner */
        #loading-spinner { display: flex; justify-content: center; align-items: center; height: 100vh; }
        .spinner { width: 50px; height: 50px; border: 5px solid var(--surface-light); border-top-color: var(--accent-color); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Header */
        .header { padding: 1rem 1.5rem; }
        .search-container { position: relative; }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); width: 20px; height: 20px; }
        .search-bar { width: 100%; background-color: var(--surface-color); border: 1px solid var(--border-color); border-radius: 50px; padding: 0.9rem 1rem 0.9rem 3rem; color: var(--text-primary); font-size: 1rem; }
        .section-title { font-size: 1.5rem; color: var(--text-primary); margin: 1.5rem 0; font-weight: 700; }
        
        /* App List */
        .app-list { display: flex; flex-direction: column; gap: 1rem; }
        .app-item { display: flex; align-items: center; gap: 1rem; padding: 0.8rem; border-radius: 12px; cursor: pointer; transition: background-color 0.2s, transform 0.2s; }
        .app-item:hover { background-color: var(--surface-color); transform: translateY(-2px); }
        .app-item img { width: 64px; height: 64px; border-radius: 16px; flex-shrink: 0; }
        .app-info { flex-grow: 1; overflow: hidden; }
        .app-info h3 { margin: 0 0 0.25rem 0; font-size: 1.1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 600; }
        .app-info p, .app-meta span { color: var(--text-secondary); font-size: 0.9rem; }
        
        /* App Detail Page */
        #app-detail-container { padding: 1rem; }
        .app-detail-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; }
        .app-detail-header img { width: 80px; height: 80px; border-radius: 20px; }
        .app-detail-info h1 { font-size: 1.8rem; margin: 0 0 0.3rem 0; }
        .app-detail-info p { color: var(--accent-color); font-weight: 600; margin: 0; }
        .app-detail-meta { display: flex; justify-content: space-around; text-align: center; padding: 1.5rem 0; border-top: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color); margin: 1.5rem 0; }
        .meta-item { color: var(--text-secondary); }
        .meta-item div { font-size: 1.2rem; font-weight: bold; color: var(--text-primary); margin-bottom: 0.3rem; }
        .app-detail-description h3 { font-size: 1.2rem; margin-bottom: 0.5rem; }
        .app-detail-description p { color: var(--text-secondary); line-height: 1.6; }
        .detail-download-button { display: block; width: 100%; background-color: var(--accent-color); border: none; color: #fff; padding: 1rem; border-radius: 12px; font-size: 1.2rem; font-weight: 700; cursor: pointer; text-align: center; text-decoration: none; margin-top: 2rem; }
        .back-button { background: none; border: none; color: var(--text-primary); font-size: 1.5rem; cursor: pointer; margin-bottom: 1rem; }
        
        /* Native Ad Container Style */
        .native-ad-container { margin-top: 2.5rem; text-align: center; }
        .native-ad-container .ad-label { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.5rem; display: block; }

        /* Category Page */
        .category-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .category-button { background-color: var(--surface-color); border: none; color: var(--text-primary); padding: 1rem; border-radius: 12px; font-size: 1rem; cursor: pointer; display: flex; align-items: center; gap: 0.8rem; font-weight: 600; }
        .category-button svg { width: 24px; height: 24px; color: var(--accent-color); }
        
        /* Report Page */
        .report-form { display: flex; flex-direction: column; gap: 1.5rem; max-width: 600px; margin: auto; }
        .report-form .form-group { position: relative; }
        .report-form label { position: absolute; left: 1rem; top: -0.7rem; background-color: var(--background-color); padding: 0 0.5rem; font-size: 0.9rem; color: var(--text-secondary); }
        .report-form input, .report-form textarea { background-color: transparent; border: 1px solid var(--border-color); color: var(--text-primary); padding: 1rem; border-radius: 12px; font-size: 1rem; }
        .report-form button { background-color: var(--accent-color); border: none; color: #fff; padding: 1rem; border-radius: 12px; font-size: 1.1rem; cursor: pointer; font-weight: 700; }
        
        /* Bottom Navigation Menu */
        .bottom-nav { position: fixed; bottom: 1rem; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; background-color: rgba(42, 42, 42, 0.9); backdrop-filter: blur(10px); display: flex; justify-content: space-around; border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); z-index: 1001; padding: 0.5rem 0; }
        .nav-button { background: none; border: none; color: var(--text-secondary); padding: 0.5rem; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; flex: 1; cursor: pointer; }
        .nav-button.active { color: var(--accent-color); }
        .nav-button svg { width: 28px; height: 28px; }
        .nav-button span { font-size: 0.7rem; font-weight: 500; }
        .hidden { display: none; }
        
        footer { text-align: center; padding: 2rem; color: var(--text-secondary); margin-top: 2rem; border-top: 1px solid var(--border-color); }
    </style>
</head>
<body>
    
    <div id="loading-spinner"><div class="spinner"></div></div>

    <main id="main-content">
        <div id="main-pages">
            <header id="page-header" class="header">
                <div class="search-container">
                    <svg class="search-icon" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path></svg>
                    <input type="text" id="searchInput" class="search-bar" placeholder="Search Apps & Games...">
                </div>
            </header>

            <div id="home-page" class="page-content active">
                <h2 class="section-title" id="page-title">Featured Apps</h2>
                <div id="app-list" class="app-list"></div>
            </div>
            
            <div id="categories-page" class="page-content">
                <h2 class="section-title">Explore by Category</h2>
                <div id="category-grid" class="category-grid"></div>
            </div>
            
            <div id="report-page" class="page-content">
                <h2 class="section-title">Submit a Report</h2>
                <form id="report-form" class="report-form">
                    <div class="form-group"><label for="report-title">Title</label><input type="text" id="report-title" required></div>
                    <div class="form-group"><label for="report-whatsapp">WhatsApp Number</label><input type="tel" id="report-whatsapp" required></div>
                    <div class="form-group"><label for="report-description">Description</label><textarea id="report-description" rows="5" required></textarea></div>
                    <button type="submit">Submit Report</button>
                    <div id="success-message" class="hidden" style="text-align:center; color: var(--accent-color);">Report sent successfully!</div>
                </form>
            </div>
        </div>

        <div id="app-detail-page" class="page-content"></div>
        <footer><p>&copy; 2025 MD OSMAN GONI. All rights reserved.</p></footer>
    </main>
    
    <nav class="bottom-nav">
        <button class="nav-button active" data-page="home-page"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/></svg><span>Home</span></button>
        <button class="nav-button" data-page="categories-page"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg><span>Categories</span></button>
        <button class="nav-button" data-page="report-page"><svg fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636M12 18a6 6 0 100-12 6 6 0 000 12z" clip-rule="evenodd"/></svg><span>Report</span></button>
    </nav>

    <!-- Adsterra Pop-under, Social Bar, এবং Native Banner কোড -->
    <script type='text/javascript' src='//pl24305937.effectivegatecpm.com/01/82/60/0182604d9acf5ec2e4aa4c7c4b17be5a.js'></script>
    <script type='text/javascript' src='//pl24304696.effectivegatecpm.com/37/54/9a/37549ab19a396d9e74de51a26d64b017.js'></script>
    <script async="async" data-cfasync="false" src="//pl24304712.effectivegatecpm.com/0ae11e6a89fb1101a45e9b71effed5b5/invoke.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const firebaseConfig = {
                apiKey: "AIzaSyDR9_p1nu3RqDWGIHVubYUvy_tasrH3zUs",
                authDomain: "moodvantech.firebaseapp.com",
                databaseURL: "https://moodvantech-default-rtdb.firebaseio.com",
                projectId: "moodvantech",
                storageBucket: "moodvantech.appspot.com",
                messagingSenderId: "447794004479",
                appId: "1:447794004479:web:01b533e0c4dfbd3119a7ca"
            };

            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();

            let allApps = [];
            const mainContent = document.getElementById('main-content');
            const mainPages = document.getElementById('main-pages');
            const pageHeader = document.getElementById('page-header');
            const loadingSpinner = document.getElementById('loading-spinner');
            const appList = document.getElementById('app-list');
            const searchInput = document.getElementById('searchInput');
            const navButtons = document.querySelectorAll('.nav-button');
            const pages = document.querySelectorAll('.page-content');
            const pageTitle = document.getElementById('page-title');
            const categoryGrid = document.getElementById('category-grid');
            const reportForm = document.getElementById('report-form');
            const appDetailPage = document.getElementById('app-detail-page');

            const adsterraSmartLink = 'https://www.effectivegatecpm.com/kjdgh92d?key=8e28004b7bffe1a54ed0cb95f68edf08';

            // --- নতুন ফাংশন: পেজ লোড হওয়ার সময় URL চেক করার জন্য ---
            function handleUrlRouting() {
                const hash = window.location.hash;
                if (hash && hash.startsWith('#app=')) {
                    const appId = hash.substring(5); // '#app=' লেখাটি বাদ দিয়ে আইডি নেওয়া
                    // ডেটা লোড হওয়ার পর অ্যাপটি দেখানোর জন্য একটু অপেক্ষা করা
                    setTimeout(() => showAppDetailPage(appId), 100); 
                }
            }

            function fetchApps() {
                database.ref('apps').orderByChild('created_at').on('value', (s) => {
                    allApps = [];
                    s.forEach((cs) => { allApps.push({ id: cs.key, ...cs.val() }); });
                    allApps.reverse();
                    displayApps(allApps);
                    populateCategories();
                    loadingSpinner.style.display = 'none';
                    mainContent.style.display = 'block';

                    // --- এখানে নতুন ফাংশনটি কল করা হয়েছে ---
                    // অ্যাপের ডেটা লোড হওয়ার পরে URL চেক করা হচ্ছে
                    handleUrlRouting();

                }, (error) => {
                    loadingSpinner.innerHTML = `<p>Error loading data. Please try again later.</p>`;
                });
            }

            function displayApps(apps) {
                appList.innerHTML = apps.length ? apps.map(app => `
                    <div class="app-item" data-id="${app.id}">
                        <img src="${app.icon_url}" alt="${app.name}">
                        <div class="app-info">
                            <h3>${app.name}</h3>
                            <p>${app.developer || app.category}</p>
                            <div class="app-meta"><span>⭐ ${app.rating || 'N/A'}</span> • <span>${app.size || ''}</span></div>
                        </div>
                    </div>`).join('') : '<p>No apps found.</p>';
            }
            
            function showAppDetailPage(appId) {
                const app = allApps.find(a => a.id === appId);
                if (!app) {
                    console.error("App not found:", appId);
                    // যদি অ্যাপ খুঁজে না পাওয়া যায়, হোম পেজে ফেরত পাঠানো
                    window.location.hash = '';
                    showMainPages();
                    return;
                }

                appDetailPage.innerHTML = `
                    <div id="app-detail-container">
                        <button class="back-button" onclick="showMainPages()">←</button>
                        <div class="app-detail-header">
                            <img src="${app.icon_url}" alt="${app.name}">
                            <div class="app-detail-info">
                                <h1>${app.name}</h1>
                                <p>${app.developer}</p>
                            </div>
                        </div>
                        <div class="app-detail-meta">
                            <div class="meta-item"><div>⭐ ${app.rating || 'N/A'}</div>Rating</div>
                            <div class="meta-item"><div>${app.size || 'N/A'}</div>Size</div>
                            <div class="meta-item"><div>${app.category}</div>Category</div>
                        </div>
                        <div class="app-detail-description">
                            <h3>About this app</h3>
                            <p>${app.description.replace(/\n/g, '<br>')}</p>
                        </div>
                        <a href="${app.download_link}" class="detail-download-button" data-is-download="true">Download</a>
                        
                        <!-- Native Banner Ad Container -->
                        <div class="native-ad-container">
                            <small class="ad-label">Sponsored</small>
                            <div id="container-0ae11e6a89fb1101a45e9b71effed5b5"></div>
                        </div>
                    </div>
                `;
                mainPages.style.display = 'none';
                appDetailPage.style.display = 'block';
                appDetailPage.classList.add('active');
                
                // --- পরিবর্তন: শেয়ার করার জন্য URL-এ হ্যাশ যুক্ত করা ---
                window.location.hash = `app=${appId}`;
            }

            // --- showMainPages ফাংশনটি গ্লোবাল করা হয়েছে ---
            window.showMainPages = function() {
                appDetailPage.classList.remove('active');
                appDetailPage.style.display = 'none';
                mainPages.style.display = 'block';

                // --- পরিবর্তন: হোম পেজে ফিরে আসার সময় URL থেকে হ্যাশ মুছে ফেলা ---
                // history.pushState ব্যবহার করলে পেজ রিলোড হয় না এবং ব্রাউজার হিস্ট্রিতে নতুন এন্ট্রি তৈরি করে না
                if (window.location.hash) {
                    history.pushState("", document.title, window.location.pathname + window.location.search);
                }
            }

            document.body.addEventListener('click', e => {
                const appItem = e.target.closest('.app-item');
                if (appItem) {
                    showAppDetailPage(appItem.dataset.id);
                }

                const downloadButton = e.target.closest('[data-is-download="true"]');
                if (downloadButton) {
                    e.preventDefault();
                    const actualDownloadUrl = downloadButton.href;
                    
                    window.open(adsterraSmartLink, '_blank');
                    
                    setTimeout(() => {
                        window.location.href = actualDownloadUrl;
                    }, 500);
                }
            });
            
            function populateCategories() {
                const categories = [...new Set(allApps.map(app => app.category).filter(Boolean))];
                categoryGrid.innerHTML = categories.map(cat => `<button class="category-button" data-category="${cat}">${cat}</button>`).join('');
            }
            
            function switchPage(pageId) {
                // --- পরিবর্তন: যেকোনো পেজে যাওয়ার আগে ডিটেলস পেজ বন্ধ করা ---
                showMainPages();
                
                pages.forEach(p => p.classList.remove('active'));
                document.getElementById(pageId).classList.add('active');
                navButtons.forEach(b => b.classList.toggle('active', b.dataset.page === pageId));
                
                if (pageId === 'report-page') {
                    pageHeader.style.display = 'none';
                } else {
                    pageHeader.style.display = 'block';
                }
            }
            
            navButtons.forEach(button => button.addEventListener('click', () => switchPage(button.dataset.page)));

            categoryGrid.addEventListener('click', e => {
                const target = e.target.closest('.category-button');
                if (target) {
                    const category = target.dataset.category;
                    displayApps(allApps.filter(app => app.category === category));
                    pageTitle.textContent = category;
                    switchPage('home-page');
                }
            });

            searchInput.addEventListener('input', e => {
                const term = e.target.value.toLowerCase();
                displayApps(allApps.filter(app => app.name.toLowerCase().includes(term)));
                pageTitle.textContent = term ? `Results for "${term}"` : 'Featured Apps';
                switchPage('home-page');
            });

            reportForm.addEventListener('submit', e => {
                e.preventDefault();
                database.ref('reports').push({
                    title: document.getElementById('report-title').value,
                    whatsapp: document.getElementById('report-whatsapp').value,
                    description: document.getElementById('report-description').value,
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                }).then(() => {
                    reportForm.reset();
                    const successMsg = document.getElementById('success-message');
                    successMsg.classList.remove('hidden');
                    setTimeout(() => successMsg.classList.add('hidden'), 3000);
                });
            });

            // --- অ্যাপস লোড করার প্রক্রিয়া শুরু ---
            fetchApps();
        });
    </script>
</body>
</html>